<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√≥ kho√°c bomber d√π hai l·ªõp nam n·ªØ JULIDO tr∆∞·ª£t n∆∞·ªõc</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin-bottom: 20px;
        }

        .product-card {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      color: #ff5a1f;
      }

        .product-header {
            background: #D4A017;
            padding: 25px;
            text-align: center;
        }

        .product-header h1 {
            color: white;
            font-size: 28px;
            font-weight: bold;
        }
        .heading {
        font-size: 20px;
        text-transform: capitalize;
        font-weight: 700;
        }
        header {
      background: #c67401;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #ddd;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
    
    }
        .product-image {
            background: #F5F5DC;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px dashed #D4A017;
            margin: 30px;
            border-radius: 10px;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            object-position: center; 
            display: block;
        }

        .product-image::before {
            font-size: 20px;
            color: #999;
        }

        .product-info {
            padding: 0 30px 30px 30px;
        }

        .info-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #FFFEF0;
            border-radius: 8px;
            border-left: 4px solid #D4A017;
        }

        .info-section h3 {
            color: #D4A017;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .info-content {
            color: #555;
            line-height: 1.6;
        }
        /* CSS cho ph·∫ßn th√¥ng tin ng∆∞·ªùi b√°n */

        .seller-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #FFFEF0;
            border-radius: 8px;
            border-left: 4px solid #D4A017;
        }

        .seller-section h3 {
            color: #D4A017;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .seller-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .seller-avatar {
            flex-shrink: 0;
        }

        .seller-details {
            flex-grow: 1;
        }

        .seller-details p {
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
        }

        .seller-name {
            font-size: 16px;
            color: #333;
        }

        .seller-button {
            background: #D4A017;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .seller-button:hover {
            background: #B8860B;
        }

        .loading {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }

        /* Responsive cho mobile */
        @media (max-width: 768px) {
            .seller-info {
                flex-direction: column;
                text-align: center;
            }

            .seller-avatar {
                margin: 0 auto;
            }
        }

        .price-box {
            background: #D4A017;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        .price-box h3 {
            color: white;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .price {
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        .buy-button {
            width: 100%;
            background: #D4A017;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .buy-button:hover {
            background: #B8860B;
        }

        @media (max-width: 768px) {
            .product-header h1 {
                font-size: 22px;
            }
            
            .product-image {
                margin: 20px;
                height: 250px;
            }
        }
        .codepen-button {
  font-family: monospace;
  font-weight: bolder;
  display: block;
  cursor: pointer;
  color: #000;
  margin: 0 auto;
  position: relative;
  text-decoration: none;
  font-weight: 600;
  border-radius: 6px;
  overflow: hidden;
  padding: 3px;
  width: 160px;
  isolation: isolate;
  transform: scale(0.85);
}

.codepen-button::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 420%;
  height: 120%;
  background: linear-gradient(
    115deg,
    #628fbc,
    hsl(0, 93%, 73%),
    #f032a7,
    #329af0,
    #f032a7
  );
  background-size: 25% 100%;
  animation: border-animation 0.75s linear infinite;
  animation-play-state: paused;
  translate: -5% 0%;
  transition: translate 0.25s ease-out;
}

.codepen-button:hover::before {
  animation-play-state: running;
  transition-duration: 0.75s;
  translate: 0% 0%;
}

@keyframes border-animation {
  to {
    transform: translateX(-25%);
  }
}

.codepen-button span {
  position: relative;
  display: block;
  padding: 1rem 1.5rem;
  font-size: 1.1rem;
  background: #fff;
  border-radius: 3px;
  height: 100%;
}

.codepen-button .span {
  display: flex;
  flex-direction: row;
  justify-content: start;
  align-items: center;
  gap: 10px;
}

.codepen-button .p {
  margin: 0;
}
    </style>
</head>
<body>

  <header>
    <div class="logo">
      <a href="../main.html"><img src="../../data/img/logo.png" alt="Logo" height="40" /> </a>

        <a class="codepen-button" style="margin-left:1050px" href="../cart.html">
            <span class="span">
                <p class="p">Gi·ªè H√†ng</p>
            <svg
            xmlns="http://www.w3.org/2000/svg"
            height="1em"
            viewBox="0 0 576 512"
            fill="#000"
            class="cart"
            >
            <path
                d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"
            ></path></svg></span
        ></a>

        <a class="codepen-button" style="margin-left:0px;width: 130px;" href="../profile.html">
            <span class="span">
                <p class="p">Profile</p>
            <svg
            height="1em">
            </svg></span
        ></a>


        
            
    </div>


  </header>
    <div class="product-card">
        <div class="product-header">
            <h1>A√≥ kho√°c bomber d√π hai l·ªõp nam n·ªØ JULIDO tr∆∞·ª£t n∆∞·ªõc</h1>
        </div>

        <div class="product-image"> <img src="../../data/img/sp5.jpg"></div>

        <div class="product-info">
            <div class="info-section">
                <h3>Chi ti·∫øt A√≥ kho√°c JULIDO</h3>
                <h3>Ch·∫•t li·ªáu :d√π tr√°ng b·∫°c c·∫£n gi√≥ c·∫£n n∆∞·ªõc ch·ªëng tia uv </h3>
                
            </div>
                       
                <div class="seller-section" id="sellerSection">
                    <h3>üë§ Th√¥ng tin ng∆∞·ªùi b√°n</h3>
                    <div class="loading" id="sellerLoading">ƒêang t·∫£i th√¥ng tin ng∆∞·ªùi b√°n...</div>
                    <div class="seller-info" id="sellerInfo" style="display: none;">
                        <div class="seller-avatar">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#D4A017" width="60" height="60">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                            </svg>
                        </div>
                        <div class="seller-details">
                            <p class="seller-name"><strong>T√™n c·ª≠a h√†ng:</strong> <span id="sellerName">...</span></p>
                            <p class="seller-email">üìß Email: <span id="sellerEmail">...</span></p>
                            <p class="seller-id">üÜî Seller ID: <span id="sellerId">...</span></p>
                            <p class="seller-joined">üìÖ Tham gia: <span id="sellerJoined">...</span></p>
                            <button class="seller-button" onclick="viewSellerShop()">Xem Shop</button>
                        </div>
                    </div>
                </div>

            <div class="price-box">
                <h3>GI√Å B√ÅN</h3>
                <div class="price">14.997‚Ç´</div>
            </div>

            <button data-product-id="105" class="buy-button" id="buyBtn5">ƒê·∫∂T H√ÄNG NGAY</button>
        </div>
    </div>
</body>
</html>


<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://cfzctoqsrkprcjstoqmp.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmemN0b3FzcmtwcmNqc3RvcW1wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NDk5NjMsImV4cCI6MjA3ODMyNTk2M30.6p6c5JCwYimAp5kOQYvJ94jdciyhGNjB08c4uFI9eLc';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// L·∫•y user id t·ª´ session
async function getUserId(){
  try{
    const r = await supabase.auth.getSession();
    return r?.data?.session?.user?.id ?? null;
  }catch(e){
    console.warn(e);
    return null;
  }
}

function getProductIdFromCard(btn){
  // t√¨m element .card c√≥ data-product-id
  const card = btn.closest('[data-product-id]') || btn.closest('.card') || btn.parentElement;
  if(!card) return null;
  const pid = card.dataset.productId || card.getAttribute('data-product-id');
  return pid ? Number(pid) : null;
}

async function addToCart(productId) {
  const userId = await getUserId();
  if (!userId) {
    alert('B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ l∆∞u gi·ªè h√†ng.');
    return;
  }
  if (!productId) {
    alert('Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c product_id.');
    return;
  }

  try {
    // B∆Ø·ªöC 1: L·∫•y seller_id t·ª´ b·∫£ng products
    const { data: productData, error: productError } = await supabase
      .from('products')
      .select('seller_id')
      .eq('id', productId)
      .single();

    if (productError || !productData?.seller_id) {
      console.error('L·ªói l·∫•y seller_id:', productError);
      alert('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi b√°n c·ªßa s·∫£n ph·∫©m n√†y!');
      return;
    }

    const sellerId = productData.seller_id; // ƒê√öNG: d√πng let/const, c√≥ scope r√µ r√†ng

    // B∆Ø·ªöC 2: Ki·ªÉm tra s·∫£n ph·∫©m ƒë√£ c√≥ trong gi·ªè ch∆∞a
    const { data: existing, error: checkError } = await supabase
      .from('cart_items')
      .select('id, quantity')
      .eq('user_id', userId)
      .eq('product_id', productId)
      .maybeSingle();

    if (checkError && checkError.code !== 'PGRST116') {
      console.error('L·ªói ki·ªÉm tra gi·ªè h√†ng:', checkError);
      alert('L·ªói h·ªá th·ªëng khi ki·ªÉm tra gi·ªè h√†ng');
      return;
    }

    if (existing) {
      // ƒê√£ c√≥ ‚Üí tƒÉng s·ªë l∆∞·ª£ng
      const { error: updateError } = await supabase
        .from('cart_items')
        .update({ quantity: existing.quantity + 1 })
        .eq('id', existing.id);

      if (updateError) {
        alert('C·∫≠p nh·∫≠t gi·ªè h√†ng th·∫•t b·∫°i!');
        console.error(updateError);
      } else {
        alert('ƒê√£ tƒÉng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè!');
      }
    } else {
      // Ch∆∞a c√≥ ‚Üí th√™m m·ªõi + c√≥ seller_id
      const { error: insertError } = await supabase
        .from('cart_items')
        .insert({
          user_id: userId,
          product_id: productId,
          quantity: 1,
          seller_id: sellerId   // ƒê·∫¢M B·∫¢O 100% c√≥ gi√° tr·ªã UUID ·ªü ƒë√¢y
        });

      if (insertError) {
        console.error('Insert error:', insertError);
        alert('Th√™m v√†o gi·ªè th·∫•t b·∫°i: ' + insertError.message);
      } else {
        alert('ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng th√†nh c√¥ng!');
      }
    }
  } catch (err) {
    console.error('L·ªói kh√¥ng x√°c ƒë·ªãnh:', err);
    alert('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!');
  }
}

// ch·ªù DOM s·∫µn s√†ng tr∆∞·ªõc khi g·∫Øn s·ª± ki·ªán
document.addEventListener('DOMContentLoaded', () => {
  // g·∫Øn cho c√°c n√∫t hi·ªán c√≥
  document.querySelectorAll('button.fancy, button[id^="buyBtn5"], .button').forEach(btn=>{
    btn.addEventListener('click', async (e)=>{
      const fromBtnPid = btn.dataset?.productId ? Number(btn.dataset.productId) : null;
      const pid = fromBtnPid || getProductIdFromCard(btn);
      await addToCart(pid);
    });
  });
});


async function loadSellerInfo(productId) {
    try {
        // 1. L·∫•y th√¥ng tin s·∫£n ph·∫©m ƒë·ªÉ c√≥ seller_id
        const { data: product, error: productError } = await supabase
            .from('products')
            .select('seller_id')
            .eq('id', productId)
            .single();

        if (productError) {
            console.error('L·ªói khi l·∫•y th√¥ng tin s·∫£n ph·∫©m:', productError);
            document.getElementById('sellerLoading').textContent = 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ng∆∞·ªùi b√°n';
            return;
        }

        if (!product || !product.seller_id) {
            document.getElementById('sellerLoading').textContent = 'Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi b√°n';
            return;
        }

        // 2. L·∫•y th√¥ng tin ng∆∞·ªùi b√°n t·ª´ b·∫£ng users ho·∫∑c auth.users
        // Ch√∫ √Ω: N·∫øu b·∫°n d√πng b·∫£ng ri√™ng cho sellers, thay 'auth.users' b·∫±ng t√™n b·∫£ng ƒë√≥
        const { data: seller, error: sellerError } = await supabase
            .from('profiles') // ho·∫∑c t√™n b·∫£ng sellers c·ªßa b·∫°n
            .select('*')
            .eq('id', product.seller_id)
            .single();

        if (sellerError) {
            console.error('L·ªói khi l·∫•y th√¥ng tin ng∆∞·ªùi b√°n:', sellerError);
            
            // N·∫øu kh√¥ng c√≥ b·∫£ng users, th·ª≠ l·∫•y t·ª´ auth metadata
            const { data: authData } = await supabase.auth.admin.getUserById(product.seller_id);
            if (authData && authData.user) {
                displaySellerInfo({
                    id: authData.user.id,
                    email: authData.user.email,
                    name: authData.user.user_metadata?.full_name || authData.user.email,
                    created_at: authData.user.created_at
                });
            } else {
                document.getElementById('sellerLoading').textContent = 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin ng∆∞·ªùi b√°n';
            }
            return;
        }

        // 3. Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi b√°n
        displaySellerInfo(seller);

    } catch (error) {
        console.error('L·ªói:', error);
        document.getElementById('sellerLoading').textContent = 'ƒê√£ x·∫£y ra l·ªói khi t·∫£i th√¥ng tin';
    }
}

// H√†m hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi b√°n
function displaySellerInfo(seller) {
    document.getElementById('sellerLoading').style.display = 'none';
    document.getElementById('sellerInfo').style.display = 'flex';
    
    // C·∫≠p nh·∫≠t th√¥ng tin v√†o HTML
    document.getElementById('sellerName').textContent = seller.full_name || seller.email || 'Kh√¥ng c√≥ t√™n';
    document.getElementById('sellerEmail').textContent = seller.email || 'Kh√¥ng c√≥ email';
    document.getElementById('sellerId').textContent = seller.id;
    
    // Format ng√†y tham gia
    if (seller.created_at) {
        const date = new Date(seller.created_at);
        document.getElementById('sellerJoined').textContent = date.toLocaleDateString('vi-VN');
    } else {
        document.getElementById('sellerJoined').textContent = 'Kh√¥ng r√µ';
    }
}

// H√†m xem shop c·ªßa ng∆∞·ªùi b√°n (c√≥ th·ªÉ customize sau)
function viewSellerShop() {
    const sellerId = document.getElementById('sellerId').textContent;
    alert('Ch·ª©c nƒÉng xem shop ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn.\nSeller ID: ' + sellerId);
    // window.location.href = '/seller-shop.html?id=' + sellerId;
}

// G·ªçi h√†m load th√¥ng tin ng∆∞·ªùi b√°n khi trang load
document.addEventListener('DOMContentLoaded', () => {
    // L·∫•y product ID t·ª´ button ho·∫∑c t·ª´ URL
    const productId = 101; // Ho·∫∑c l·∫•y t·ª´ URL: new URLSearchParams(window.location.search).get('id')
    
    loadSellerInfo(productId);
});
</script>